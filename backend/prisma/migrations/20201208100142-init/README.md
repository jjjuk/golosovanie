# Migration `20201208100142-init`

This migration has been generated by jjjuk at 12/8/2020, 6:01:42 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "User" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "name" TEXT NOT NULL,
    "color" TEXT,
    "password" TEXT,
    "online" BOOLEAN
)

CREATE TABLE "Poll" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "createdAt" TEXT NOT NULL,
    "active" BOOLEAN NOT NULL DEFAULT true,
    "userId" INTEGER NOT NULL,
    "firstStageTime" TEXT NOT NULL,
    "secondStageTime" TEXT NOT NULL,

    FOREIGN KEY ("userId") REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE TABLE "Event" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "name" TEXT NOT NULL,
    "approved" BOOLEAN NOT NULL DEFAULT false,
    "startTime" TEXT NOT NULL
)

CREATE TABLE "Vote" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "createdAt" TEXT NOT NULL,
    "pollId" INTEGER NOT NULL,
    "userId" INTEGER NOT NULL,
    "eventId" INTEGER NOT NULL,

    FOREIGN KEY ("pollId") REFERENCES "Poll"("id") ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY ("userId") REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY ("eventId") REFERENCES "Event"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE TABLE "Participant" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "userId" INTEGER NOT NULL,
    "eventId" INTEGER NOT NULL,

    FOREIGN KEY ("userId") REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY ("eventId") REFERENCES "Event"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE UNIQUE INDEX "User.name_unique" ON "User"("name")

CREATE UNIQUE INDEX "unique_vote" ON "Vote"("userId", "id")

CREATE UNIQUE INDEX "unique_participant" ON "Participant"("userId", "eventId")
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201208100142-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,60 @@
+// This is your Prisma schema file,
+// learn more about it in the docs: https://pris.ly/d/prisma-schema
+
+datasource db {
+  provider = "sqlite"
+  url = "***"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model User {
+  id Int @default(autoincrement()) @id
+  name String @unique
+  color String?
+  password String?
+  online Boolean?  
+}
+
+model Poll {
+  id Int @default(autoincrement()) @id
+  createdAt String
+  active Boolean @default(true)
+  userId Int
+  user User @relation(fields: [userId], references: [id])
+  firstStageTime String
+  secondStageTime String
+  votes Vote[]
+}
+
+model Event {
+  id Int @default(autoincrement()) @id
+  name String
+  approved Boolean @default(false)
+  startTime String
+}
+
+model Vote {
+  id Int @default(autoincrement()) @id
+  createdAt String
+  pollId Int
+  poll Poll @relation(fields: [pollId], references: [id])
+  userId Int
+  user User @relation(fields: [userId], references: [id])
+  eventId Int
+  event Event @relation(fields: [eventId], references: [id])
+
+  @@unique([userId, id], name: "unique_vote")
+}
+
+model Participant {
+  id Int @default(autoincrement()) @id
+  userId Int
+  user User @relation(fields: [userId], references: [id])
+  eventId Int
+  event Event @relation(fields: [eventId], references: [id])
+
+  @@unique([userId, eventId], name: "unique_participant")
+}
```


